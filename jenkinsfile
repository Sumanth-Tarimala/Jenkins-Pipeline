pipeline {
    agent any 
    stages {
        stage('Checkout') { 
            steps {
                checkout([$class: 'GitSCM', branches: [[name: '*/main']], extensions: [], userRemoteConfigs: [[credentialsId: 'Jenkins', url: 'https://github.com/Sumanth-Tarimala/Jenkins-Pipeline.git']]])
		echo 'Code Checkout Completed'
            }
        }
        stage('Build') { 
            steps {
                 sh '''
		    whoami
                    git log -m --name-only -1 --oneline --pretty=format:"" > /var/jenkins_home/workspace/terraform-pipeline/git_log.txt
                    git archive --format=zip --output=/C/Users/Sentinel/Sentinel-Policies/`date +"%d%m%Y_H%"`_Sentinel_$(git log -n 1 --pretty=format:"%h").zip $(git log -n 1 --pretty=format:"%h")
                    cd /var/jenkins_home/workspace/terraform-pipeline/enforce-secure-reboot
		    terraform plan
                 '''
            }
        }
        stage('Deploy') { 
            steps {
                echo ("Deploy Stages") 
            }
        }
    }
}
